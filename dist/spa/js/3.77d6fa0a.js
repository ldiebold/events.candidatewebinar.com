(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[3,9],{2721:function(e,t,s){"use strict";s.r(t);var i=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("q-page",{key:e.$route.params.online_event_id,attrs:{padding:""}},[e.onlineEvent?s("div",{staticClass:"column items-center q-mt-md"},[s("div",{class:[e.$q.platform.is.mobile?"text-h4":"text-h2","text-grey-8"]},[e._v("\n      "+e._s(e.onlineEvent.title)+"\n    ")]),s("div",{staticClass:"text-h5 text-grey-6 q-mb-sm"},[e._v("\n      "+e._s(e.onlineEvent.description)+"\n    ")]),!1===e.session_has_started&&!1===e.session_has_ended?s("q-banner",{staticClass:"bg-blue text-white full-width text-center q-mb-lg q-mt-lg"},[e._v("\n      Session will start "+e._s(e.timeUntilStartHumanized)+"\n    ")]):e._e(),!0===e.session_has_ended?s("q-banner",{staticClass:"bg-grey-8 text-white text-center full-width q-mb-lg q-mt-lg"},[e._v("\n      Session has Ended\n    ")]):e._e(),!0!==e.session_has_started||!1!==e.session_has_ended||e.hasClickedJoin?e._e():s("q-btn",{staticClass:"text-center",attrs:{label:"join",color:"primary"},on:{click:function(t){e.hasClickedJoin=!0}}}),!0===e.session_has_started&&!1===e.session_has_ended&&e.hasClickedJoin?s("div",{staticClass:"full-width",staticStyle:{"max-width":"80%"}},[e.videoId?s("VimeoVideo",{ref:"video",attrs:{"video-id":e.videoId},on:{ready:e.handleVideoReady}}):e._e()],1):e._e(),s("div",{directives:[{name:"show",rawName:"v-show",value:!0===e.session_has_started&&!1===e.session_has_ended&&e.hasClickedJoin,expression:"session_has_started === true && session_has_ended === false && hasClickedJoin"}]},[e._v("\n      Video Not playing? Try clicking/touching the screen\n    ")])],1):e._e()])},n=[],a=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("q-video",{ref:"qVideo",staticClass:"full-width",attrs:{beep:"",ratio:16/9,src:"https://player.vimeo.com/video/"+e.videoId,allow:"autoplay"}})},r=[],d=s("aaf1"),o={props:{videoId:{required:!0,type:String}},mounted(){const e=this.$refs.qVideo.$el.querySelector("iframe");this.video=new d["a"](e),this.video.ready().then(this.onLoad)},computed:{},methods:{onLoad(e){this.$emit("ready",this.video)},getPlayer(){return this.video}},data(){return{video:null}}},l=o,h=s("a6c2"),u=s("4745"),v=s("63c1"),c=s.n(v),_=Object(h["a"])(l,a,r,!1,null,null,null),m=_.exports;c()(_,"components",{QVideo:u["a"]});var g=s("8d35"),f=s.n(g),p=s("3cf6"),S=s.n(p),y=(s("b05d"),s("7014"));f.a.extend(y);var w={name:"OnlineEventPageVimeo",components:{VimeoVideo:m},props:{onlineEventCandidate:{required:!1,type:[Object,Boolean],default:!1}},watch:{"$route.params.online_event_id"(e,t){this.hasClickedJoin=!1,this.clearIntervals(),this.startObservations()}},mounted(){this.user&&this.$MUser.$getCandidates(),this.startObservations()},methods:{startObservations(){const e=this;this.sessionTrackingIntervals=setInterval((()=>{e.handleSessionLive(),e.handleSessionIsOver(),e.timeUntilStartHumanized=this.$dayjs().to(this.onlineEvent.start_time)}),300)},joinPresenceChannel(){this.$MUser.update({where:()=>!0,data:{inOnlineEvent:!1}});const e="candidate"===this.user.role?this.user.upline_id:this.user.id;this.$echo.join(`App.Models.User.${e}.Online.Event.${this.onlineEvent.id}`).here((e=>{this.$MUser.insertOrUpdate({data:e})})).joining((e=>{this.$MUser.insertOrUpdate({data:e})})).leaving((e=>{this.$MUser.update({where:e.id,data:{inOnlineEvent:!1}})})).listen("NewMessage",(e=>{}))},handleVideoEnded(){this.session_has_ended=!0},updateCurrentVideoTime(){this.$refs.video.getPlayer().getCurrentTime().then((e=>{this.currentVideoTime=e}))},handleVideoReady(e){e.getDuration().then(this.handleGotDuration).then((e=>{this.$refs.video.getPlayer().on("play",(e=>{this.duration=e.duration})),this.$refs.video.getPlayer().on("end",(e=>{this.handleVideoEnded()})),this.$refs.video.getPlayer().on("pause",(e=>{this.$refs.video.getPlayer().play()})),this.$refs.video.getPlayer().play();const t=this;t.setVideoInitialPlayTime(),this.videoStatusIntervals=setInterval((()=>{t.updateCurrentVideoTime(),t.handleVideoOutOfPlayTime()}),300)}))},handleGotDuration(e){this.duration=e},clearIntervals(){clearInterval(this.videoStatusIntervals),clearInterval(this.sessionTrackingIntervals)},getSessionIsOver(){return-1===Math.sign(f()(this.onlineEvent.end_time).diff(new Date,"seconds"))||!(!this.duration||-1!==Math.sign(f()(this.onlineEvent.start_time).add(this.duration+this.live_leeway,"second").diff(new Date,"seconds")))},handleSessionIsOver(){this.session_has_ended=this.getSessionIsOver(),this.session_has_ended&&this.clearIntervals()},handleSessionLive(){this.session_has_started=this.getSessionIsLive()},getSessionIsLive(){return this.getSessionHasStarted()&&1===Math.sign(f()(this.onlineEvent.end_time).diff(new Date,"seconds"))},getSessionHasStarted(){return this.getTimeSinceStart()>0},getMinutesUntilLive(){return f()().diff(this.onlineEvent.start_time,"seconds")},getSessionHasNotStarted(){return!this.getSessionHasStarted()},setVideoInitialPlayTime(){this.duration&&-1===Math.sign(f()(this.onlineEvent.start_time).add(this.duration,"second").diff(new Date,"seconds"))?this.session_has_ended=!0:this.getSessionIsLive()&&this.$refs.video.getPlayer().setCurrentTime(this.getTimeSinceStart())},handleVideoOutOfPlayTime(){this.getSessionHasNotStarted()||this.getSessionIsOver()||this.getVideoIsOutOfLeeway()&&(this.$refs.video.getPlayer().setCurrentTime.getCurrentTime>=this.duration-1?this.session_has_ended=!0:this.$refs.video.getPlayer().setCurrentTime(this.getTimeSinceStart()))},getTimeSinceStart(){const e=f()(new Date).diff(this.onlineEvent.start_time,"second");return e},getStartTimeMinusLeeway(){return this.getTimeSinceStart()-this.live_leeway},getStartTimePlusLeeway(){return this.getTimeSinceStart()+this.live_leeway},getVideoIsOutOfLeeway(){const e=this.currentVideoTime>this.getStartTimePlusLeeway(),t=this.currentVideoTime<this.getStartTimeMinusLeeway();return e||t}},computed:{onlineEvent(){return this.onlineEventCandidate?this.onlineEventCandidate:this.$MOnlineEvent.find(this.$route.params.online_event_id)},videoId(){return this.onlineEvent.video_url?S.a.parse(this.onlineEvent.video_url).id:null},user(){return this.$MUser.getSessionUser()}},data(){return{videoStatusIntervals:null,sessionTrackingIntervals:null,duration:null,player:null,live_leeway:10,currentVideoTime:0,video_visible:!1,session_has_started:!1,session_has_ended:!0,timeUntilStartHumanized:null,hasClickedJoin:!1}}},E=w,O=s("505d"),$=s("91e4"),I=s("ef9c"),T=s("5ce7"),C=Object(h["a"])(E,i,n,!1,null,null,null);t["default"]=C.exports;c()(C,"components",{QPage:O["a"],QBanner:$["a"],QBtn:I["a"],QCard:T["a"]})},dd6a:function(e,t,s){"use strict";s.r(t);var i=function(){var e=this,t=e.$createElement,s=e._self._c||t;return e.closest_online_event?s("OnlineEventPageVimeo",{attrs:{"online-event-candidate":e.closest_online_event}}):s("div")},n=[],a=(s("68e1"),s("2721")),r={name:"PageIndex",data(){return{user:null}},mounted(){},components:{OnlineEventPageVimeo:a["default"]},computed:{closest_online_event(){return this.onlineEventsOrdered[0]},onlineEventsOrdered(){return this.$MOnlineEvent.all().sort((function(e,t){return new Date(e.start_time)-new Date(t.start_time)}))}},methods:{}},d=r,o=s("a6c2"),l=Object(o["a"])(d,i,n,!1,null,null,null);t["default"]=l.exports}}]);