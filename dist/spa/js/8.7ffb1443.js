(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[8],{2721:function(e,t,i){"use strict";i.r(t);var s=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("q-page",{key:e.$route.params.online_event_id,attrs:{padding:""}},[e.onlineEvent?i("div",{staticClass:"column items-center q-mt-md"},[i("div",{class:[e.$q.platform.is.mobile?"text-h4":"text-h2","text-grey-8"]},[e._v("\n      "+e._s(e.onlineEvent.title)+"\n    ")]),i("div",{staticClass:"text-h5 text-grey-6 q-mb-sm"},[e._v("\n      "+e._s(e.onlineEvent.description)+"\n    ")]),!1===e.session_has_started&&!1===e.session_has_ended?i("q-banner",{staticClass:"bg-blue text-white full-width text-center q-mb-lg q-mt-lg"},[e._v("\n      Session will start "+e._s(e.timeUntilStartHumanized)+"\n    ")]):e._e(),!0===e.session_has_ended?i("q-banner",{staticClass:"bg-grey-8 text-white text-center full-width q-mb-lg q-mt-lg"},[e._v("\n      Session has Ended\n    ")]):e._e(),!0!==e.session_has_started||!1!==e.session_has_ended||e.hasClickedJoin?e._e():i("q-btn",{staticClass:"text-center",attrs:{label:"join",color:"primary"},on:{click:function(t){e.hasClickedJoin=!0}}}),!0===e.session_has_started&&!1===e.session_has_ended&&e.hasClickedJoin?i("div",{staticClass:"full-width",staticStyle:{"max-width":"80%"}},[e.videoId?i("VimeoVideo",{ref:"video",attrs:{"video-id":e.videoId},on:{ready:e.handleVideoReady}}):e._e()],1):e._e()],1):e._e()])},n=[],a=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("q-video",{ref:"qVideo",staticClass:"full-width",attrs:{beep:"",ratio:16/9,src:"https://player.vimeo.com/video/"+e.videoId,allow:"autoplay"}})},r=[],d=i("aaf1"),o={props:{videoId:{required:!0,type:String}},mounted(){const e=this.$refs.qVideo.$el.querySelector("iframe");this.video=new d["a"](e),this.video.ready().then(this.onLoad)},computed:{},methods:{onLoad(e){this.$emit("ready",this.video)},getPlayer(){return this.video}},data(){return{video:null}}},l=o,h=i("a6c2"),u=i("4745"),v=i("63c1"),c=i.n(v),m=Object(h["a"])(l,a,r,!1,null,null,null),_=m.exports;c()(m,"components",{QVideo:u["a"]});var g=i("8d35"),S=i.n(g),f=i("3cf6"),p=i.n(f),y=(i("b05d"),i("7014"));S.a.extend(y);var w={name:"OnlineEventPageVimeo",components:{VimeoVideo:_},props:{onlineEventCandidate:{required:!1,type:[Object,Boolean],default:!1}},watch:{"$route.params.online_event_id"(e,t){this.hasClickedJoin=!1,this.clearIntervals(),this.startObservations()}},mounted(){this.$MUser.$getCandidates(),this.startObservations()},methods:{startObservations(){const e=this;this.sessionTrackingIntervals=setInterval((()=>{e.handleSessionLive(),e.handleSessionIsOver(),e.timeUntilStartHumanized=this.$dayjs().to(this.onlineEvent.start_time)}),300)},joinPresenceChannel(){this.$MUser.update({where:()=>!0,data:{inOnlineEvent:!1}});const e="candidate"===this.user.role?this.user.upline_id:this.user.id;this.$echo.join(`App.Models.User.${e}.Online.Event.${this.onlineEvent.id}`).here((e=>{this.$MUser.insertOrUpdate({data:e})})).joining((e=>{this.$MUser.insertOrUpdate({data:e})})).leaving((e=>{this.$MUser.update({where:e.id,data:{inOnlineEvent:!1}})})).listen("NewMessage",(e=>{}))},handleVideoEnded(){this.session_has_ended=!0},updateCurrentVideoTime(){this.$refs.video.getPlayer().getCurrentTime().then((e=>{this.currentVideoTime=e}))},handleVideoReady(e){e.getDuration().then(this.handleGotDuration).then((e=>{this.$refs.video.getPlayer().on("play",(e=>{this.duration=e.duration})),this.$refs.video.getPlayer().on("end",(e=>{this.handleVideoEnded()})),this.$refs.video.getPlayer().on("pause",(e=>{this.$refs.video.getPlayer().play()})),this.$refs.video.getPlayer().play();const t=this;t.setVideoInitialPlayTime(),this.videoStatusIntervals=setInterval((()=>{t.updateCurrentVideoTime(),t.handleVideoOutOfPlayTime()}),300)}))},handleGotDuration(e){this.duration=e},clearIntervals(){clearInterval(this.videoStatusIntervals),clearInterval(this.sessionTrackingIntervals)},getSessionIsOver(){return-1===Math.sign(S()(this.onlineEvent.end_time).diff(new Date,"seconds"))||!(!this.duration||-1!==Math.sign(S()(this.onlineEvent.start_time).add(this.duration+this.live_leeway,"second").diff(new Date,"seconds")))},handleSessionIsOver(){this.session_has_ended=this.getSessionIsOver(),this.session_has_ended&&this.clearIntervals()},handleSessionLive(){this.session_has_started=this.getSessionIsLive()},getSessionIsLive(){return this.getSessionHasStarted()&&1===Math.sign(S()(this.onlineEvent.end_time).diff(new Date,"seconds"))},getSessionHasStarted(){return this.getTimeSinceStart()>0},getMinutesUntilLive(){return S()().diff(this.onlineEvent.start_time,"seconds")},getSessionHasNotStarted(){return!this.getSessionHasStarted()},setVideoInitialPlayTime(){this.duration&&-1===Math.sign(S()(this.onlineEvent.start_time).add(this.duration,"second").diff(new Date,"seconds"))?this.session_has_ended=!0:this.getSessionIsLive()&&this.$refs.video.getPlayer().setCurrentTime(this.getTimeSinceStart())},handleVideoOutOfPlayTime(){this.getSessionHasNotStarted()||this.getSessionIsOver()||this.getVideoIsOutOfLeeway()&&(this.$refs.video.getPlayer().setCurrentTime.getCurrentTime>=this.duration-1?this.session_has_ended=!0:this.$refs.video.getPlayer().setCurrentTime(this.getTimeSinceStart()))},getTimeSinceStart(){const e=S()(new Date).diff(this.onlineEvent.start_time,"second");return e},getStartTimeMinusLeeway(){return this.getTimeSinceStart()-this.live_leeway},getStartTimePlusLeeway(){return this.getTimeSinceStart()+this.live_leeway},getVideoIsOutOfLeeway(){const e=this.currentVideoTime>this.getStartTimePlusLeeway(),t=this.currentVideoTime<this.getStartTimeMinusLeeway();return e||t}},computed:{onlineEvent(){return this.onlineEventCandidate?this.onlineEventCandidate:this.$MOnlineEvent.find(this.$route.params.online_event_id)},videoId(){return this.onlineEvent.video_url?p.a.parse(this.onlineEvent.video_url).id:null},user(){return this.$MUser.getSessionUser()}},data(){return{videoStatusIntervals:null,sessionTrackingIntervals:null,duration:null,player:null,live_leeway:10,currentVideoTime:0,video_visible:!1,session_has_started:!1,session_has_ended:!0,timeUntilStartHumanized:null,hasClickedJoin:!1}}},I=w,$=i("505d"),T=i("91e4"),E=i("ef9c"),O=i("5ce7"),C=Object(h["a"])(I,s,n,!1,null,null,null);t["default"]=C.exports;c()(C,"components",{QPage:$["a"],QBanner:T["a"],QBtn:E["a"],QCard:O["a"]})}}]);